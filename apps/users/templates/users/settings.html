{% extends "base.html" %}

{% block title %}Settings{% endblock title %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Account settings</h1>
  </div>

  <!-- Settings Card -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
    <form method="POST" class="p-6">
      {% csrf_token %}

      <!-- Theme Setting -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Theme
        </label>
        <input type="hidden" name="theme" id="themeInput" value="{{ request.user.theme|default:'dark' }}">
        <div class="relative z-20" id="themeDropdown">
          <button type="button" id="themeBtn" class="w-full px-4 py-2.5 pr-10 bg-gray-50 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white transition-colors cursor-pointer text-left">
            <span id="themeBtnText">{{ request.user.theme|default:'dark'|capfirst }}</span>
          </button>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
            <svg id="themeChevron" class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>
          <div id="themeOptions" class="hidden absolute z-50 w-full mt-1 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-lg overflow-hidden">
            <div class="theme-option px-4 py-2.5 text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer" data-value="light">Light</div>
            <div class="theme-option px-4 py-2.5 text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer" data-value="dark">Dark</div>
            <div class="theme-option px-4 py-2.5 text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 cursor-pointer rounded-b-lg" data-value="pastel">Pastel</div>
          </div>
        </div>
      </div>
      <script>
        const themeBtn = document.getElementById('themeBtn');
        const themeOptions = document.getElementById('themeOptions');
        const themeInput = document.getElementById('themeInput');
        const themeBtnText = document.getElementById('themeBtnText');
        const themeChevron = document.getElementById('themeChevron');

        themeBtn.addEventListener('click', () => {
          themeOptions.classList.toggle('hidden');
          themeChevron.classList.toggle('rotate-180');
        });

        document.querySelectorAll('.theme-option').forEach(option => {
          option.addEventListener('click', () => {
            themeInput.value = option.dataset.value;
            themeBtnText.textContent = option.textContent;
            themeOptions.classList.add('hidden');
            themeChevron.classList.remove('rotate-180');
          });
        });

        document.addEventListener('click', (e) => {
          if (!document.getElementById('themeDropdown').contains(e.target)) {
            themeOptions.classList.add('hidden');
            themeChevron.classList.remove('rotate-180');
          }
        });
      </script>
      <br>
      <!-- Accent Color -->
      <div class="pb-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Accent color
        </label>
        <div class="flex items-center gap-3">
          <div class="relative h-10 w-10">
            <input type="color"
                   id="iconHoverColor"
                   name="icon_hover_color"
                   value="{{ request.user.icon_hover_color|default:'#3b82f6' }}"
                   style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
            <div id="colorPickerBtn"
                 style="background-color: {{ request.user.icon_hover_color|default:'#3b82f6' }};"
                 class="h-10 w-10 rounded-lg border-2 border-gray-200 dark:border-gray-600 shadow-sm pointer-events-none">
            </div>
          </div>
          <span id="colorValue" class="text-sm font-mono text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">{{ request.user.icon_hover_color|default:'#3b82f6' }}</span>
        </div>
      </div>
      <script>
        const colorInput = document.getElementById('iconHoverColor');
        const colorBtn = document.getElementById('colorPickerBtn');
        const colorValue = document.getElementById('colorValue');

        colorInput.addEventListener('input', function(e) {
          colorBtn.style.backgroundColor = e.target.value;
          colorValue.textContent = e.target.value.toUpperCase();
        });
      </script>

      <!-- Actions -->
      <div class="flex flex-wrap gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
        <button type="submit" name="save_settings" class="px-5 py-2.5 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors">
          Save settings
        </button>
        <button type="submit" name="toggle_theme" class="px-5 py-2.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg transition-colors">
          Quick toggle theme
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock content %}
